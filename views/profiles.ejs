<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <%- include('partials/head') %>
        <link rel="stylesheet" href="/css/profiles.css">
    </head>

    <body>
        <header>
            <%- include('partials/header') %>
        </header>

        <main>
            <% for(let i=0; i<elencoProfili.length; i++) { %>
                <form action="/profili" method="post" id="profilesForm" >
                    <input type="hidden" name="formTrigger" value="apply" id="formTrigger" />
                    <input type="hidden" name="profileIndex" value="-1" id="formIndex"/>
                    <profile>
                        <h1><%= elencoProfili[i].nome %></h1>
                        <p><%= elencoProfili[i].descrizione %></p>
                        <div>
                            <% let j = 0, roomLabels; %>
                            <% for (let attribute in elencoProfili[i]) { %>
                                <% if( j < 8 && elencoProfili[i][attribute] != 0 ) { %>
                                    <input class="ambient" type="text" id="ambientID" value="ambientValue" readonly disabled>
                                    <input class="value" type="text" value="<%=elencoProfili[i][attribute]%>" readonly disabled>
                                    <script>
                                        roomLabels = <%- JSON.stringify(rooms) %>;
                                        document.getElementById('ambientID').value = "Luci "+roomLabels[<%=j%>];
                                        document.getElementById('ambientID').id = "led"+roomLabels[<%=j%>];
                                    </script>
                                <% } %>
                                <% if( j>=8 && j<16 && elencoProfili[i][attribute] != "Nessuno" ) { %>
                                    <input class="ambient" type="text" id="ambientID" value="ambientValue" readonly disabled>
                                    <input class="value" type="text" value="<%=elencoProfili[i][attribute]%>" readonly disabled>
                                    <script>
                                        roomLabels = <%- JSON.stringify(rooms) %>;
                                        document.getElementById('ambientID').value = "Luci "+roomLabels[<%=j%>-8];
                                        document.getElementById('ambientID').id = "pr"+roomLabels[<%=j%>-8];
                                    </script>
                                <% } %>
                                <% j++; %>

                            <% } %>

                        </div>

                    </profile>
                    <input class="applyButton" type="button" id="apply" value="Applica">
                    <input class="applyButton" type="button" id="delete" value="Elimina">
                </form>

                <script>
                    // Immediately invoked function to start apply/save/reset buttons listeners
                    ( function()
                    {
                        // Unique IDs for each button
                        const index = <%= i %>;
                        document.getElementById('apply').id = "apply"+index;
                        document.getElementById('delete').id = "delete"+index;
                        const applyButton = document.getElementById('apply'+index);
                        const deleteButton = document.getElementById('delete'+index);

                        applyButton.addEventListener('click', () => {
                            sendFormAs('apply', index);
                        });

                        deleteButton.addEventListener('click', () => {
                            sendFormAs('delete', index);
                        });
                    })();

                    function sendFormAs(trigger, index)
                    {
                        const profilesForm = document.getElementById('profilesForm');
                        document.getElementById('formTrigger').value = trigger;
                        document.getElementById('formIndex').value = index;
                        profilesForm.submit();
                    }
                </script>
            <% } %>
        </main>

        <footer>
            <%- include('partials/footer') %>
        </footer>

    </body>
</html>
